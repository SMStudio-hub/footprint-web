<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FootPrint Shop | Premium Footwear</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --main: #c0392b; --bg: #f8f9fa; --card: #ffffff; --text: #2c3e50; }
        body { font-family: 'Poppins', sans-serif; margin: 0; background: var(--bg); color: var(--text); padding-bottom: 70px; }
        
        /* Header */
        header { background: white; padding: 15px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; }
        #brandName { font-size: 24px; font-weight: 800; color: var(--main); margin: 0; text-transform: uppercase; }

        /* Carousel */
        .carousel-container { margin: 15px; position: relative; overflow: hidden; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); background: #fff; display: none; }
        .ad-slide img { width: 100%; height: 160px; object-fit: cover; }
        .ad-info { padding: 10px; text-align: center; }
        .ad-btn-mini { background: #27ae60; color: white; padding: 5px 15px; border-radius: 15px; font-size: 12px; display: inline-block; margin-top: 5px; }

        /* Search & Filter */
        .search-container { padding: 0 15px; }
        #searchInput { width: 100%; padding: 12px; border-radius: 25px; border: 1px solid #ddd; outline: none; background: #fff; box-sizing: border-box; }
        .filter-box { display: flex; gap: 10px; padding: 10px 15px; overflow-x: auto; scrollbar-width: none; }
        .filter-btn { padding: 8px 20px; border-radius: 20px; border: 1px solid #ddd; background: white; font-weight: 600; flex-shrink: 0; cursor: pointer; }
        .filter-btn.active { background: var(--main); color: white; border-color: var(--main); }

        /* Product Grid */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 10px 15px; }
        @media (min-width: 768px) { .grid { grid-template-columns: repeat(4, 1fr); } }
        .card { background: var(--card); border-radius: 15px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #f0f0f0; display: flex; flex-direction: column; }
        .card img { width: 100%; height: 150px; object-fit: cover; }
        .info { padding: 10px; flex-grow: 1; }
        .p-cat { font-size: 10px; color: #888; text-transform: uppercase; }
        .p-name { font-weight: 600; font-size: 13px; height: 36px; overflow: hidden; margin: 2px 0; }
        .p-price { color: var(--main); font-weight: 800; font-size: 15px; }
        .add-btn { width: 100%; background: #27ae60; color: white; border: none; padding: 10px; font-weight: bold; cursor: pointer; font-size: 12px; }

        /* Cart Bar */
        #cartBar { position: fixed; bottom: 0; width: 100%; background: var(--text); color: white; padding: 15px; text-align: center; font-weight: bold; display: none; cursor: pointer; z-index: 2000; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

<header><h1 id="brandName">FOOTPRINT</h1></header>

<div id="adCarousel" class="carousel-container">
    <div id="adContent"></div>
</div>

<div class="search-container">
    <input type="text" id="searchInput" placeholder="Search shoes, sizes..." oninput="handleSearch()">
</div>

<div class="filter-box">
    <button class="filter-btn active" onclick="filterProducts('All', this)">All</button>
    <button class="filter-btn" onclick="filterProducts('Sports', this)">Sports</button>
    <button class="filter-btn" onclick="filterProducts('Casual', this)">Casual</button>
    <button class="filter-btn" onclick="filterProducts('slippers', this)">Slippers</button>
</div>

<div class="grid" id="productGrid"></div>

<div id="cartBar" onclick="checkout()">
    <i class="fas fa-shopping-cart"></i> View Cart (<span id="cartCount">0</span> items) - Checkout
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBkz3peuigrkVL7GTG9o6lTyG8U9S8E-5A",
        authDomain: "footprint-shop.firebaseapp.com",
        projectId: "footprint-shop",
        storageBucket: "footprint-shop.appspot.com",
        messagingSenderId: "16952304600",
        appId: "1:16952304600:web:7c8498522407a8dceb88ad"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let allOriginalProducts = [];
    let cart = [];

    // --- ADS LOGIC ---
    onSnapshot(doc(db, "settings", "appearance"), (s) => {
        if(s.exists()){
            const d = s.data();
            document.getElementById("brandName").innerText = d.brandName || "FOOTPRINT";
            
            if(d.showAdBanner && d.adImg) {
                document.getElementById("adCarousel").style.display = "block";
                document.getElementById("adContent").innerHTML = `
                    <a href="${d.adLink || '#'}" target="_blank" onclick="trackAdClick()" style="text-decoration:none; color:inherit;">
                        <img src="${d.adImg}">
                        <div class="ad-info">
                            <b>${d.adTitle || 'SPECIAL OFFER'}</b><br>
                            <span class="ad-btn-mini">${d.adBtnText || 'View'}</span>
                        </div>
                    </a>
                `;
            } else {
                document.getElementById("adCarousel").style.display = "none";
            }
        }
    });

    window.trackAdClick = async () => {
        await updateDoc(doc(db, "settings", "appearance"), { adClicks: increment(1) });
    };

    // --- PRODUCTS & CART LOGIC ---
    onSnapshot(collection(db, "products"), (snap) => {
        allOriginalProducts = snap.docs.map(d => ({id: d.id, ...d.data()}));
        renderGrid(allOriginalProducts);
    });

    function renderGrid(products) {
        const grid = document.getElementById("productGrid");
        grid.innerHTML = products.map(p => `
            <div class="card">
                <img src="${p.img}">
                <div class="info">
                    <div class="p-cat">${p.cat}</div>
                    <div class="p-name">${p.name}</div>
                    <div class="p-price">₹${p.price}</div>
                </div>
                <button class="add-btn" onclick="addToCart('${p.name}', ${p.price})">
                    <i class="fas fa-cart-plus"></i> ADD TO CART
                </button>
            </div>
        `).join('');
    }

    window.addToCart = (name, price) => {
        cart.push({name, price});
        const bar = document.getElementById("cartBar");
        bar.style.display = "block";
        document.getElementById("cartCount").innerText = cart.length;
        bar.style.animation = "none";
        bar.offsetHeight;
        bar.style.animation = "popup 0.3s ease";
    };

    window.checkout = () => {
        if(cart.length === 0) return;
        let msg = "Hello! I want to order:\n";
        let total = 0;
        cart.forEach(item => {
            msg += `• ${item.name} - ₹${item.price}\n`;
            total += item.price;
        });
        msg += `\n*Total: ₹${total}*`;
        window.open(`https://wa.me/917003478789?text=${encodeURIComponent(msg)}`, '_blank');
    };

    window.filterProducts = (cat, btn) => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const filtered = cat === 'All' ? allOriginalProducts : allOriginalProducts.filter(p => p.cat === cat);
        renderGrid(filtered);
    };

    window.handleSearch = () => {
        const query = document.getElementById("searchInput").value.toLowerCase();
        const filtered = allOriginalProducts.filter(p => p.name.toLowerCase().includes(query) || p.cat.toLowerCase().includes(query));
        renderGrid(filtered);
    };
</script>
<style>
    @keyframes popup { 0% { transform: translateY(100%); } 100% { transform: translateY(0); } }
</style>
</body>
</html>
